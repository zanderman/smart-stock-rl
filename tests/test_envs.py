import io
import pandas as pd
import pytest
import smart_stock as ss
from stable_baselines3.common.env_checker import check_env


@pytest.fixture()
def stock_dataframe() -> pd.DataFrame:
    testdata = io.StringIO("""Date,Open,High,Low,Close,Volume,OpenInt
1984-09-07,0.42388,0.42902,0.41874,0.42388,23220030,0
1984-09-10,0.42388,0.42516,0.41366,0.42134,18022532,0
1984-09-11,0.42516,0.43668,0.42516,0.42902,42498199,0
1984-09-12,0.42902,0.43157,0.41618,0.41618,37125801,0
1984-09-13,0.43927,0.44052,0.43927,0.43927,57822062,0
1984-09-14,0.44052,0.45589,0.44052,0.44566,68847968,0
1984-09-17,0.45718,0.46357,0.45718,0.45718,53755262,0
1984-09-18,0.45718,0.46103,0.44052,0.44052,27136886,0
1984-09-19,0.44052,0.44566,0.43157,0.43157,29641922,0
1984-09-20,0.43286,0.43668,0.43286,0.43286,18453585,0
1984-09-21,0.43286,0.44566,0.42388,0.42902,27842780,0
1984-09-24,0.42902,0.43157,0.42516,0.42516,22033109,0
1984-09-25,0.42388,0.42388,0.41618,0.41618,46515020,0
1984-09-26,0.41618,0.4354,0.41111,0.41111,30947546,0
1984-09-27,0.41111,0.41366,0.41111,0.41111,29541971,0""")
    df = pd.read_csv(testdata, sep=',')
    return df


def test_stock_env(stock_dataframe):

    env = ss.envs.stock_env.StockEnv(
        stock_dataframe,
        100.,
    )
    check_env(env)